<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>INSANE Long Drive Simulator</title>
<style>
body { margin:0; overflow:hidden; background:#87CEEB; font-family:Arial; }
#ui {
  position:absolute;
  bottom:20px;
  left:50%;
  transform:translateX(-50%);
  width:500px;
  text-align:center;
  color:white;
}
.barContainer {
  width:100%;
  height:18px;
  background:#222;
  border-radius:10px;
  overflow:hidden;
  margin-top:5px;
}
.bar { height:100%; width:0%; }
#powerBar { background:linear-gradient(to right,red,yellow,lime); }
#info { margin-top:8px; font-size:18px; }
#club { position:absolute; top:20px; left:20px; color:white; }
#wind { position:absolute; top:20px; right:20px; color:white; }
</style>
</head>
<body>

<div id="club">Club: Driver (1-3)</div>
<div id="wind">Wind: 0 m/s</div>

<div id="ui">
Power
<div class="barContainer"><div id="powerBar" class="bar"></div></div>
<div id="info">Hold SPACE to swing</div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

<script>

// ================= BASIC =================

let scene = new THREE.Scene();
scene.fog = new THREE.Fog(0x87CEEB, 800, 3000);

let camera = new THREE.PerspectiveCamera(70, innerWidth/innerHeight, 0.1, 5000);
let renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth, innerHeight);
renderer.outputEncoding = THREE.sRGBEncoding;
renderer.toneMapping = THREE.ACESFilmicToneMapping;
renderer.toneMappingExposure = 1.2;
renderer.setClearColor(0x87CEEB);
document.body.appendChild(renderer.domElement);

// ================= SKY =================

let skyGeo = new THREE.SphereGeometry(4000, 64, 64);
let skyMat = new THREE.MeshBasicMaterial({ color: 0x87CEEB, side: THREE.BackSide });
scene.add(new THREE.Mesh(skyGeo, skyMat));

// ================= LIGHTING =================

scene.add(new THREE.HemisphereLight(0xb1e1ff, 0x444422, 0.8));
let sun = new THREE.DirectionalLight(0xffffff, 2);
sun.position.set(300, 500, 200);
scene.add(sun);

// ================= TERRAIN =================

let terrainSize = 2000;
let terrainGeo = new THREE.PlaneGeometry(terrainSize,terrainSize,200,200);
terrainGeo.rotateX(-Math.PI/2);

function getTerrainHeight(x,z){
  return Math.sin(x*0.01)*10 + Math.cos(z*0.01)*10;
}

for(let i=0;i<terrainGeo.attributes.position.count;i++){
  let x = terrainGeo.attributes.position.getX(i);
  let z = terrainGeo.attributes.position.getZ(i);
  terrainGeo.attributes.position.setY(i,getTerrainHeight(x,z));
}
terrainGeo.computeVertexNormals();

let terrain = new THREE.Mesh(
  terrainGeo,
  new THREE.MeshStandardMaterial({color:0x2f7d32, roughness:0.95})
);
scene.add(terrain);

// ================= FLAGS =================

function createFlag(distance,color){
  let group = new THREE.Group();

  let pole = new THREE.Mesh(
    new THREE.CylinderGeometry(0.2,0.2,20,8),
    new THREE.MeshStandardMaterial({color:0xffffff})
  );
  pole.position.y = 10;
  group.add(pole);

  let flag = new THREE.Mesh(
    new THREE.PlaneGeometry(10,5),
    new THREE.MeshStandardMaterial({color:color, side:THREE.DoubleSide})
  );
  flag.position.set(5,17,0);
  group.add(flag);

  group.position.set(0,getTerrainHeight(0,-distance),-distance);
  scene.add(group);
}

createFlag(100,0xff0000);
createFlag(200,0x0000ff);
createFlag(300,0xffff00);
createFlag(400,0xff00ff);

// ================= BALL =================

let ball = new THREE.Mesh(
  new THREE.SphereGeometry(0.7,32,32),
  new THREE.MeshStandardMaterial({color:0xffffff})
);
ball.position.set(0,20,0);
scene.add(ball);

// ================= GAME =================

let velocity = new THREE.Vector3();
let gravity = -40;
let wind = (Math.random()-0.5)*8;
let rolling = false;

let clubs = {
  Driver:{power:120, loft:0.6},
  Wood:{power:100, loft:0.7},
  Iron:{power:85, loft:0.9}
};

let currentClub="Driver";
updateUI();

function updateUI(){
  document.getElementById("club").innerText="Club: "+currentClub+" (1-3)";
  document.getElementById("wind").innerText="Wind: "+wind.toFixed(1)+" m/s";
}

// ================= CONTROLS =================

let charging=false;
let power=0;
let powerDir=1;
let launched=false;
let aimAngle=0;

document.addEventListener("keydown", e=>{
  if(e.key==="1") currentClub="Driver";
  if(e.key==="2") currentClub="Wood";
  if(e.key==="3") currentClub="Iron";
  if(e.code==="Space" && !launched) charging=true;
  if(e.code==="ArrowLeft") aimAngle+=2;
  if(e.code==="ArrowRight") aimAngle-=2;
  updateUI();
});

document.addEventListener("keyup", e=>{
  if(e.code==="Space" && charging && !launched){
    charging=false;
    shoot();
  }
});

// ================= SHOOT =================

function shoot(){
  launched=true;
  rolling=false;

  let club=clubs[currentClub];
  let strength=power*club.power;
  let rad=THREE.MathUtils.degToRad(aimAngle);

  velocity.x=Math.sin(rad)*strength;
  velocity.z=-Math.cos(rad)*strength;
  velocity.y=strength*club.loft;

  document.getElementById("info").innerText="SMASH!";
}

// ================= RESET =================

function resetGame(){
  ball.position.set(0,20,0);
  velocity.set(0,0,0);
  launched=false;
  rolling=false;
  power=0;
  wind=(Math.random()-0.5)*8;
  updateUI();
  document.getElementById("info").innerText="Hold SPACE to swing";
}

// ================= CAMERA =================

camera.position.set(0,40,100);

// ================= LOOP =================

let clock=new THREE.Clock();

function animate(){
  requestAnimationFrame(animate);
  let delta=clock.getDelta();

  if(charging){
    power+=powerDir*delta;
    if(power>=1){power=1;powerDir=-1;}
    if(power<=0){power=0;powerDir=1;}
    document.getElementById("powerBar").style.width=(power*100)+"%";
  }

  if(launched){

    if(!rolling){
      velocity.y+=gravity*delta;
      velocity.x+=wind*delta;
    }

    ball.position.add(velocity.clone().multiplyScalar(delta));

    let groundHeight = getTerrainHeight(ball.position.x,ball.position.z)+0.7;

    if(ball.position.y<=groundHeight){
      ball.position.y=groundHeight;
      velocity.y=0;
      rolling=true;
    }

    if(rolling){
      velocity.multiplyScalar(0.98);

      // downhill roll
      let slopeX = getTerrainHeight(ball.position.x+1,ball.position.z) - groundHeight;
      let slopeZ = getTerrainHeight(ball.position.x,ball.position.z+1) - groundHeight;

      velocity.x += slopeX*5*delta;
      velocity.z += slopeZ*5*delta;

      if(velocity.length()<0.5){
        launched=false;
        let dist=Math.sqrt(ball.position.x**2+ball.position.z**2).toFixed(1);
        document.getElementById("info").innerText="Distance: "+dist+" m";
        setTimeout(resetGame,5000);
      }
    }

    camera.position.lerp(
      new THREE.Vector3(
        ball.position.x,
        ball.position.y+40,
        ball.position.z+100
      ),0.05
    );
    camera.lookAt(ball.position);
  }

  renderer.render(scene,camera);
}

animate();

</script>
</body>
</html>
